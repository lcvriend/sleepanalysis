<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slaapanalyse</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.1"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <link rel="stylesheet" href="static/stylesheet.css">
    <style>
    </style>
</head>
<body>
    <header>
        <h1>Slaapanalyse</h1>
        <img src="static/noun-sleep-disorder-5145226.svg" alt="">
    </header>
    <main>
        <section>
            <h2>Toelichting</h2>
            <table>
                <thead>
                    <tr>
                        <th>Indicator</th>
                        <th>Variabele</th>
                        <th>Norm</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Slaapduur</th>
                        <td>Totaalduur slapen</td>
                        <td>Minstens 7 uur per nacht (<a href="https://doi.org/10.1016/j.socscimed.2010.05.041">Buxton &amp; Marcelli, 2010</a>)</td>
                    </tr>
                    <tr>
                        <th>Slaapefficiëntie</th>
                        <td>Verhouding in bed/slapen</td>
                        <td>Minstens 85% (<a href="https://psycnet.apa.org/doi/10.1037/a0028204">Astill e.a., 2012</a>)</td>
                    </tr>
                    <tr>
                        <th rowspan="3">slaapcontinuïteit</th>
                        <td>Inslaapduur</td>
                        <td>Binnen 30 min.</td>
                    </tr>
                    <tr>
                        <td>Aantal keer wakker</td>
                        <td>Max. 2 keer wakker</td>
                    </tr>
                    <tr>
                        <td>Totaal duur wakker</td>
                        <td>Minder dan 90 min. wakker na inslapen</td>
                    </tr>
                </tbody>
            </table>
        </section>
        <section>
            <h2>Laad data</h2>
            <div class="inputs">
                <label for="fileInput">Selecteer een csv bestand:</label>
                <input type="file" id="fileInput">
                <label for="loadExample">Of laad een voorbeeldbestand:</label>
                <button id="loadExample">Laad voorbeeld</button>
            </div>
        </section>
        <section>
            <h2>Gegevens</h2>
            <div id="metadata"></div>
        </section>
        <section>
            <h2>Tabel</h2>
            <div id="table"></div>
        </section>
        <section>
            <h2>Grafieken</h2>
            <div id="chart-timelines"></div>
            <div id="chart-percentages"></div>
        </section>
        <section>
            <h2>Overige informatie</h2>
            <p>Deze tool is ontwikkeld door:</p>
            <ul>
                <li>L.P.H. Vriend</li>
                <li>L.C. Vriend</li>
            </ul>
            <p>De code is open source beschikbaar; zie <a href="https://github.com/lcvriend/sleepanalysis">github.com/lcvriend/sleepanalysis</a>.</p>
            <p>De grafieken zijn gemaakt met <a href="https://vega.github.io/vega-lite/">Vega-Lite</a>.</p>
        </section>
    </main>
<script type="module">
    import { analyzeSleepPatterns } from "./src/sleepanalysis.js"
    const loadExample = document.getElementById("loadExample")
    const fileInput = document.getElementById("fileInput")
    const elementIds = {
        timelines: "#chart-timelines",
        percentages: "#chart-percentages",
        table: "#table",
        metadata: "#metadata",
    }

    fileInput.addEventListener("change", event => {
        const file = event.target.files[0]
        const reader = new FileReader()
        reader.readAsText(file)
        reader.onload = (event) => {
            const source = event.target.result
            analyzeSleepPatterns(source, elementIds)
        }
    })

    loadExample.addEventListener("click", () => {
        fetch("data/example.csv")
            .then(response => response.text())
            .then(data => {
                analyzeSleepPatterns(data, elementIds)
            })
            .catch(error => {
                console.error("Error:", error)
            })
    })

</script>
</body>
